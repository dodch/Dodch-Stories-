<!DOCTYPE html>
<!--
/***************************************************************************************************
 *                                   ** DO NOT COPY - ALL RIGHTS RESERVED **
 *
 * This code is the exclusive property of Dodch Stories and its owner. Unauthorized copying,
 * reproduction, modification, distribution, or any form of use of this code, in whole or in part,
 * is strictly prohibited.
 *
 * The intellectual property rights, including copyright, for this software are protected by
 * international laws and treaties. Any infringement of these rights will be pursued to the
 * fullest extent of the law, which may include civil and criminal charges.
 *
 * Copyright (c) 2024 Dodch Stories. All rights reserved.
 ***************************************************************************************************/
-->
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="canonical" href="https://www.dodchstories.com/">
  <meta name="google-site-verification" content="WPsemouAlOQyJaztzjjtf6afzzagtg6WWPZh7gd3T8A">
  <title>Dodch Stories | Original Fiction and Creative Writing</title>
  <!-- NEW: Content Security Policy to prevent XSS and other injection attacks. -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' https://*.google.com https://*.gstatic.com https://*.firebaseio.com https-*.googleapis.com;
    script-src 'self' 'unsafe-inline' https://www.google.com/recaptcha/ https://www.gstatic.com/ https://cdnjs.cloudflare.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdnjs.cloudflare.com;
    img-src 'self' https://img.icons8.com https://lh3.googleusercontent.com https://i.ibb.co data:;
    font-src 'self' https://fonts.gstatic.com;
    connect-src 'self' wss://*.firebaseio.com https://www.google-analytics.com https://firebase.googleapis.com https://identitytoolkit.googleapis.com;
    frame-src 'self' https://www.google.com/recaptcha/;
  ">

  <meta name="description" content="Dodch Stories is a collection of original stories written with emotion, creativity, and depth. Explore fiction that connects to the heart and imagination.">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
  <!-- FIX: Add preconnect hints for Google Fonts to improve loading speed and reliability on all systems, including Windows. -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Quattrocento+Sans:ital,wght@1,400&family=Open+Sans:wght@400;700&family=Playfair+Display:wght@900&family=Montserrat:wght@900&display=swap">
  <!-- FIX: Prioritize the .ico file for Windows and provide the SVG as a modern alternative. -->
  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
  <link rel="manifest" href="site.webmanifest" />

  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png" />
  <!-- FIX: Add 192x192 icon for high-DPI screens and Chrome UI elements. -->
  <link rel="icon" type="image/png" sizes="192x192" href="web-app-manifest-192x192.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />

  <meta name="apple-mobile-web-app-title" content="MyWebSite" />

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Dodch",
    "url": "https://www.dodchstories.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.dodchstories.com/favicon-96x96.png",
      "width": 96,
      "height": 96
    },
    "creator": {
      "@type": "Person",
      "name": "Adam Dodch"
    }
  }
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  
  <!-- NEW: Add reCAPTCHA v3 script for Firebase App Check -->
  <script src="https://www.google.com/recaptcha/api.js?render=6Ldj7O8rAAAAAO5rRT1GqGzVN3vXjL54Mlw0mpX6" async defer></script>
  <!-- NEW: Unified script for security, theme, and background loading. -->
  <script src="shared-init.js" defer></script>

  <link rel="stylesheet" href="style.css">
</head>
<body>
<!-- NEW: Add dedicated background divs, mirroring the working story pages. -->
<div class="fixed-background light-background"></div>
<div class="fixed-background dark-background"></div>

<!-- NEW: Add the top and bottom gradient blur vignettes -->
<div class="top-vignette-main"></div>
<div class="bottom-vignette-main"></div>

<div class="top-left-fixed-wrapper">
  <div class="info-container-wrapper" id="infoContainerWrapper">
    <div class="info-button glass-button-base" id="infoButton" title="Info">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12" y2="8"></line>
      </svg>
    </div>
    <!-- NEW: Login Button -->
    <div id="auth-container" class="auth-container glass-button-base">
      <button id="loginButton" class="login-button">
        <span class="login-text">Login</span>
      </button>
    </div>
  </div>
</div>

<!-- FIX: Move the close button outside the panel to prevent it from scrolling. -->
<div class="close-button" id="closeInfoButton">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</div>
<div class="info-panel" id="infoPanel">
    <div class="info-content">
      <h2 class="panel-anim-item">About Dodch Stories</h2>
      <p class="info-intro panel-anim-item">✨ Here, stories are not just written — they are lived. Every word is a mirror of what we can’t say out loud, symbols of who we are, and who we might become. ✨</p>
      
      <h3 class="panel-anim-item">🌌 Our Storytelling Philosophy</h3>
      <p class="panel-anim-item">We believe that everyone carries something special inside. A story on our site should not just tell events, it should:</p>
      <ul>
          <li class="panel-anim-item">Reveal what we can’t say with normal words.</li>
          <li class="panel-anim-item">Carry deep meanings, symbols, and hidden layers for readers to uncover.</li>
          <li class="panel-anim-item">Reflect the truth of our lives — sometimes directly, sometimes through metaphor or fantasy.</li>
          <li class="panel-anim-item">Show us what it feels like to be human in a way that is unforgettable.</li>
      </ul>
      <hr class="panel-anim-item">
      <h3 class="panel-anim-item">✨ What Makes a Story Right for Us</h3>
      <ul>
        <li class="panel-anim-item"><strong>Modern & Relatable:</strong> Connected to today’s life yet timeless in meaning.</li>
        <li class="panel-anim-item"><strong>Emotional Impact:</strong> Stays in the reader’s mind long after they finish.</li>
        <li class="panel-anim-item"><strong>Symbols & Hidden Meanings:</strong> Every story is more than what’s on the page.</li>
        <li class="panel-anim-item"><strong>Personal Truth:</strong> Your unique perspective and voice should shine through.</li>
      </ul>
      <hr class="panel-anim-item">
      <h3 class="panel-anim-item">🚫 What We Avoid</h3>
      <ul>
        <li class="panel-anim-item">Empty writing without purpose or depth.</li>
        <li class="panel-anim-item">Copy-paste tropes or soulless stories.</li>
        <li class="panel-anim-item">Work that doesn’t reveal anything new about life, humanity, or ourselves.</li>
      </ul>
    </div>
</div>

<div class="loading" id="loadingScreen">
  <div class="loading-text">
    <span class="loading-text-words">D</span>
    <span class="loading-text-words">O</span>
    <span class="loading-text-words">D</span>
    <span class="loading-text-words">C</span>
    <span class="loading-text-words">H</span>
  </div>
</div>

<!-- NEW: Tutorial Panel for first-time visitors -->
<div class="info-panel" id="tutorialPanel">
    <div class="info-content">
      <h2 class="panel-anim-item">Welcome to Dodch Stories!</h2>
      <p class="info-intro panel-anim-item">Here’s a quick guide to get you started.</p>
      <div class="tutorial-section ">
        <h3 class="tutorial-heading panel-anim-item">Reading & Saving</h3>
        <ul>
            <li class="panel-anim-item">
              <span class="tutorial-icon-text">👆</span>
              <div><strong>Explore Stories:</strong> Tap on any story card to dive in and read.</div>
            </li>
            <li class="panel-anim-item">
              <span class="tutorial-icon"><svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></span>
              <div><strong>Add to Favorites:</strong> Click the heart icon on a story to save it for later.</div>
            </li>
        </ul>
      </div>
      <div class="tutorial-section ">
        <h3 class="tutorial-heading panel-anim-item">Tools & Filters</h3>
        <ul>
            <li class="panel-anim-item">
              <span class="tutorial-icon"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></span>
              <div><strong>Search:</strong> Use the top-right button to find stories by title, author, or description.</div>
            </li>
            <li class="panel-anim-item">
              <span class="tutorial-icon"><svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></span>
              <div><strong>Filter Favorites:</strong> Tap the bottom-left heart to see only your saved stories.</div>
            </li>
        </ul>
      </div>
      <div class="tutorial-section ">
        <h3 class="tutorial-heading panel-anim-item">Connect & Contribute</h3>
        <ul>
          <li class="panel-anim-item">
            <span class="tutorial-icon"><svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></span>
            <div><strong>Get in Touch:</strong> Tap the envelope to submit a story or find us on social media.</div>
          </li>
        </ul>
      </div>
      <button class="panel-button panel-anim-item" id="tutorialStartButton">Start Exploring</button>
    </div>
</div>
<div class="notifications-container">
  <p class="notification-item"> welcome to my personal website, you can tap on any story grid to read it or add it to favorites, please enjoy ❤️ </p>
</div>
<div class="top-right-fixed-wrapper">
  <div class="search-container-wrapper" id="searchContainerWrapper">
    <div class="search-button glass-button-base" id="searchButton" title="Search">
      <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
      <svg class="close-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </div>
    <input type="text" id="searchInput" class="search-bar" placeholder="Search stories...">
  </div>
</div>
<div id="favorites-section"></div>
<div class="grid" id="grid"></div>
<span id="no-favorites-message">No favorites yet! Click the heart to add some.</span>
<div class="floating-buttons-container">
  <div class="floating-button glass-button-base" id="contactBtn" title="Contact">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
      <polyline points="22,6 12,13 2,6"></polyline>
    </svg>
  </div>
  <div class="floating-button glass-button-base" id="filterBtn" title="Show Favorites">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 
            4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 
            3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
    </svg>
  </div>
  <!-- NEW: Button to manually cycle through performance levels -->
  <div class="floating-button glass-button-base" id="perfBtn" title="Toggle Performance">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 12h16M4 6h16M4 18h16"></path>
      <circle cx="6" cy="6" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="18" cy="18" r="2"></circle>
    </svg>
  </div>
  <!-- NEW: Admin button to open the notification panel. Hidden by default. -->
  <div class="floating-button glass-button-base" id="adminOpenPanelBtn" title="Send Notification" style="display: none; background-color: color-mix(in srgb, var(--blue-tint) 20%, transparent);">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 17H2a3 3 0 0 0 3-3V9a7 7 0 0 1 14 0v5a3 3 0 0 0 3 3zm-8.27 4a2 2 0 0 1-3.46 0"></path>
        <path d="M12 2.69A1.65 1.65 0 0 0 10.31 4L12 6l1.69-2A1.65 1.65 0 0 0 12 2.69z"></path>
    </svg>
  </div>
  <!-- NEW: Admin Panel for sending notifications. Hidden by default. -->
  <div id="adminPanel" class="modal-panel" style="z-index: 102;">
    <div class="contact-panel-content">
        <h2 style="color: var(--glass-text); font-size: 1.5rem; margin-bottom: 1rem; text-align: center;">Send Notification</h2>
        <input type="text" id="notificationTitle" class="search-bar active" placeholder="Notification Title" style="position: relative; width: 100%; right: 0; margin-bottom: 1rem;">
        <textarea id="notificationBody" class="search-bar active" placeholder="Notification Body..." style="position: relative; width: 100%; right: 0; height: 100px; padding-top: 1rem; resize: vertical;"></textarea>
        <button id="sendNotificationBtn" class="panel-button">Send to All Users</button>
    </div>
  </div>
  <div class="close-button" id="closeAdminPanelButton">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </div>
</div>
<svg style="display:none" >
  <!-- FIX: Expand the filter area to prevent edge artifacts from the strong displacement. -->
  <filter id="filter-hq" color-interpolation-filters="linearRGB" x="-20%" y="-20%" width="140%" height="140%">
    <!-- 1. Generate noise for the watery distortion. -->
    <feTurbulence type="fractalNoise" baseFrequency="0.001" numOctaves="4" seed="5" result="noise"/>
    <!-- 2. Apply the watery distortion to the source graphic. -->
    <feDisplacementMap in="SourceGraphic" in2="noise" scale="350" xChannelSelector="R" yChannelSelector="G" result="distorted"/>
    <!-- 3. Create a height map from the card's alpha channel and blur it to create a smooth, convex shape. -->
    <feGaussianBlur in="SourceAlpha" stdDeviation="10" result="bump"/>
    <!-- 4. Define a light source. -->
    <feDistantLight azimuth="235" elevation="50"/>
    <!-- 5. Create diffuse lighting (soft shadows) to add depth. -->
    <feDiffuseLighting in="bump" lighting-color="#444" surfaceScale="10" result="diffuse"/>
    <!-- 6. Create specular lighting (sharp highlights) for a glossy look. Increased specularExponent for sharper highlights. -->
    <feSpecularLighting in="bump" lighting-color="white" surfaceScale="10" specularConstant="1.5" specularExponent="60" result="specular"/>
    <!-- 7. Combine the lighting effects. -->
    <feComposite in="diffuse" in2="specular" operator="arithmetic" k1="1" k2="0" k3="0" k4="0" result="lighting"/>
    <!-- 8. Composite the final lighting over the distorted graphic for a high-contrast 3D effect. -->
    <feComposite in="distorted" in2="lighting" operator="arithmetic" k1="0" k2="1" k3="0.5" k4="0"/>
  </filter>
  <filter id="filter-lq" color-interpolation-filters="linearRGB">
    <feTurbulence type="fractalNoise" baseFrequency="0.1" numOctaves="1" result="turbulence"/>
    <feDisplacementMap in="SourceGraphic" in2="turbulence" scale="1"/>
  </filter>
</svg>
<div class="scroll-fix"></div>
<footer class="site-footer">
  <div></div> <!-- This empty div occupies the left grid column, creating a safe area for the buttons. -->
  <div class="site-footer-content">
    <p>&copy; 2024 Dodch Stories. All Rights Reserved.</p>
    <p class="recaptcha-branding">
      This site is protected by reCAPTCHA and the Google
      <a href="https://policies.google.com/privacy" target="_blank" rel="noopener noreferrer">Privacy Policy</a> and
      <a href="https://policies.google.com/terms" target="_blank" rel="noopener noreferrer">Terms of Service</a> apply.
    </p>
  </div>
</footer>
<!-- FIX: Move close buttons outside their panels to ensure they remain fixed. -->
<div class="close-button" id="closeContactButton">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</div>
<!-- NEW: Add a fixed header for the Contact panel -->
<div class="modal-header-fixed" id="contactModalHeaderFixed">
    <h2 class="modal-main-title" id="contactModalTitle">Contact</h2>
</div>

<div class="modal-panel" id="contactPanel">
    <div class="contact-panel-content">
      <a class="panel-button" id="submitStoryBtn" href="mailto:dodchstories@gmail.com">
        <span>Submit Your Story</span>
        <!-- REFACTOR: Replaced the old mail icon with a cleaner "send" (paper plane) icon. -->
        <svg class="button-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </a>
      <button class="panel-button social" id="openSocialButton">
        <span>Social Media</span>
        <div class="social-icons-inline">
          <img src="https://img.icons8.com/ios-filled/50/ffffff/tiktok--v1.png" alt="TikTok" class="social-icon-inline">
          <img src="https://img.icons8.com/fluency/48/instagram-new.png" alt="Instagram" class="social-icon-inline">
          <img src="https://img.icons8.com/fluency/48/facebook-new.png" alt="Facebook" class="social-icon-inline">
        </div>
      </button>
    </div>
</div>
<div class="close-button" id="closeSocialButton">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</div>
<!-- NEW: Add a fixed header for the Social Media panel -->
<div class="modal-header-fixed" id="socialModalHeaderFixed">
    <h2 class="modal-main-title" id="socialModalTitle">Social Media</h2>
</div>

<div class="modal-panel" id="socialPanel">
    <div class="social-links-content">
      <a class="panel-button social-link-button" id="tiktokBtn" href="https://www.tiktok.com/@dodchadam?_t=ZM-8zxCtYC2iXj&_r=1" target="_blank" rel="noopener noreferrer">
        <img src="https://img.icons8.com/ios-filled/50/ffffff/tiktok--v1.png" alt="TikTok" class="social-icon-img">
        <span>Tiktok</span>
      </a>
      <a class="panel-button social-link-button" id="instagramBtn" href="https://www.instagram.com/adamdodch?igsh=eng4Z3h4NGpjczVo&utm_source=qr" target="_blank" rel="noopener noreferrer">
        <img src="https://img.icons8.com/fluency/48/instagram-new.png" alt="Instagram" class="social-icon-img">
        <span>Instagram</span>
      </a>
      <a class="panel-button social-link-button" id="facebookBtn" href="https://www.facebook.com/share/17YCuswrPL/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer">
        <img src="https://img.icons8.com/fluency/48/facebook-new.png" alt="Facebook" class="social-icon-img">
        <span>Facebook</span>
      </a>
    </div>
</div>
<!-- NEW: Series Modal -->
<div class="close-button" id="closeSeriesModalButton">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</div>
<div class="modal-panel" id="seriesModal">
    <h2 id="seriesModalTitle"></h2>
    <div class="series-parts-grid" id="seriesPartsGrid">
        <!-- Series parts will be injected here by JavaScript -->
    </div>
</div>
<!-- NEW: Comments Modal -->
<div class="close-button" id="closeCommentsModalButton">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</div>
<!-- NEW: Add vignettes for the comments modal -->
<div class="top-vignette-modal"></div>
<div class="bottom-vignette-modal"></div>

<div class="modal-panel" id="commentsModal">
    <!-- REFACTOR: Restructure comments modal for better styling and layout -->
    <div class="comments-panel-content" id="commentsPanelContent">
        <div class="comments-list" id="commentsList">
            <!-- Comments will be injected here by JavaScript -->
        </div>
    </div>
</div>

<!-- REFACTOR: Move title completely outside the modal to make it truly fixed. -->
<div class="modal-header-fixed" id="commentsModalHeaderFixed">
    <h2 id="commentsModalTitle">Comments <span id="commentsModalCount">(0)</span></h2>
</div>
<!-- REFACTOR: Move input area completely outside the modal to make it truly fixed. -->
<div class="comment-input-area" id="commentInputArea">
    <textarea id="commentTextarea" class="glass-button-base" placeholder="Add a comment (50 words max)..." maxlength="350"></textarea>
    <button id="postCommentBtn" class="panel-button glass-button-base" title="Post Comment">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
    </button>
</div>
<!-- FIX: Use modern Firebase Modular (ESM) SDK -->
<script type="module">
    // Your web app's Firebase configuration
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics.js";
    import { getDatabase, ref, onValue, runTransaction, set, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut, setPersistence, browserSessionPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
    import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app-check.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-messaging.js";
    import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-functions.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBIlDy8iaEpCHVc6kPij_zh2zHJYQqiShk",
      authDomain: "dodchstories-435bb.firebaseapp.com",
      databaseURL: "https://dodchstories-435bb-default-rtdb.firebaseio.com",
      projectId: "dodchstories-435bb",
      storageBucket: "dodchstories-435bb.firebasestorage.app",
      messagingSenderId: "52323489131",
      appId: "1:52323489131:web:1ac8292a3953032715682e",
      measurementId: "G-7MCXBETRYQ"
    };

    // Initialize Firebase and make services globally available
    const app = initializeApp(firebaseConfig);

    // NEW: Initialize Firebase App Check with reCAPTCHA v3
    const appCheck = initializeAppCheck(app, {
      provider: new ReCaptchaV3Provider('6Ldj7O8rAAAAAO5rRT1GqGzVN3vXjL54Mlw0mpX6'),
      isTokenAutoRefreshEnabled: true
    });
    const analytics = getAnalytics(app);
    const database = getDatabase(app);
    const auth = getAuth(app);
    const messaging = getMessaging(app);
    const functions = getFunctions(app);

    // Make Firebase functions globally accessible to script.js
    window.firebaseServices = {
        db: database,
        auth: auth,
        ref: ref,
        onValue: onValue,
        runTransaction: runTransaction,
        set: set, // NEW: Expose the 'set' function
        push: push, // NEW: Expose push for notifications
        serverTimestamp: serverTimestamp, // NEW: Expose serverTimestamp for notifications
        // NEW: Expose messaging functions
        messaging: messaging,
        getToken: getToken, 
        onMessage: onMessage,
        functions: functions,
        httpsCallable: httpsCallable,
        // NEW: Expose auth functions
        GoogleAuthProvider: GoogleAuthProvider,
        signInWithPopup: signInWithPopup,
        onAuthStateChanged: onAuthStateChanged,
        signOut: signOut,
        setPersistence: setPersistence,
        browserSessionPersistence: browserSessionPersistence,
        browserLocalPersistence: browserLocalPersistence // FIX: Expose local persistence
    };
</script>
<!--
  NEW: The Definitive Fix for the Main Page Background.
  This module script mirrors the working logic of the story pages. It runs after the DOM is ready
  and is completely isolated, ensuring there are no conflicts with other scripts. It fetches the
  backgrounds.json file and injects the correct CSS variables for the main page background.
-->
<script type="module">
  (async () => {
    try {
      const response = await fetch('backgrounds.json');
      if (!response.ok) return;
      const allBackgrounds = await response.json();
      const mainPageBackgrounds = allBackgrounds.find(item => item.type === 'mainPage');
      const bgSet = mainPageBackgrounds?.backgrounds;

      if (bgSet && bgSet.light && bgSet.dark) {
        const styleElement = document.createElement('style');
        styleElement.id = 'dynamic-main-bg-styles'; // Use a unique ID
        styleElement.innerHTML = `
          :root {
            --main-bg-url-light: url("${bgSet.light.url}");
            --main-bg-url-dark: url("${bgSet.dark.url}");
          }
        `;
        document.head.appendChild(styleElement);
      }
    } catch (error) {
      console.error("Failed to load main page background:", error);
    }
  })();
</script>
<script src="script.js" type="module"></script>
</body>
</html>
