<!DOCTYPE html>
<!--
/***************************************************************************************************
 *                                   ** DO NOT COPY - ALL RIGHTS RESERVED **
 *
 * This code is the exclusive property of Dodch Stories and its owner. Unauthorized copying,
 * reproduction, modification, distribution, or any form of use of this code, in whole or in part,
 * is strictly prohibited.
 *
 * The intellectual property rights, including copyright, for this software are protected by
 * international laws and treaties. Any infringement of these rights will be pursued to the
 * fullest extent of the law, which may include civil and criminal charges.
 *
 * Copyright (c) 2024 Dodch Stories. All rights reserved.
 ***************************************************************************************************/
-->
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon links -->
    <link rel="icon" href="../../favicon.ico" sizes="any">
    <link rel="icon" href="../../favicon.svg" type="image/svg+xml" />
    <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="../../favicon-96x96.png" />
    <!-- FIX: Corrected typo and added 192x192 icon for high-DPI screens. -->
    <link rel="icon" type="image/png" sizes="192x192" href="../../web-app-manifest-192x192.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png" />
    <link rel="manifest" href="../../site.webmanifest" />
    <title>With the right person</title>
    <meta name="description" content="A reflection on how the right person can transform your world, making the simplest moments the most valuable.">
    <!-- SEO: Add a canonical link to specify the preferred URL for this page. -->
    <link rel="canonical" href="https://www.dodchstories.com/stories/with-the-right-person.html" />
    <!-- Hreflang tags for multilingual SEO -->
    <link rel="alternate" hreflang="en" href="https://www.dodchstories.com/stories/with-the-right-person.html" />
    <link rel="alternate" hreflang="fr" href="https://www.dodchstories.com/stories/with-the-right-person.html" />
    <link rel="alternate" hreflang="ar" href="https://www.dodchstories.com/stories/with-the-right-person.html" />
    <link rel="alternate" hreflang="x-default" href="https://www.dodchstories.com/stories/with-the-right-person.html" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../story-style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Licorice&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --main-bg-url-light: url('https://i.ibb.co/Zzm7fGQ7/IMG-2465.jpg');
            --main-bg-url-dark: url("https://i.ibb.co/F4BLKf9t/IMG-2305.jpg");
        }
    </style>
    <!-- NEW: Immediate Anti-Inspection Script.
         Placing this script in the <head> ensures it runs before the page content is rendered,
         making it impossible to open DevTools without an immediate page reload. -->
    <script>
        // FIX: Add a pre-rendering script to prevent "flash of incorrect theme" (FOIT).
        // This runs before the body is rendered, checks for the 'dark' preference,
        // and applies a class to the <html> element immediately.
        (function() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark-mode');
            }
        })();
        // Disable right-click context menu globally.
        document.addEventListener('contextmenu', event => event.preventDefault());

        (function() {
            const check = () => {
                const startTime = performance.now();
                debugger;
                const endTime = performance.now();
                if (endTime - startTime > 160) {
                    window.location.reload();
                }
            };
            // Run the check immediately and on a fast interval.
            check();
            setInterval(check, 250);

            // Block common keyboard shortcuts for DevTools.
            window.addEventListener('keydown', e => {
                if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) || (e.ctrlKey && e.key === 'U')) {
                    window.location.reload();
                }
            });
        })();
    </script>
</head>
<body class="loading">
    <div id="loading-screen">
        <div class="loading-indicator">
            <span>🫂</span> <span>🫂</span> <span>🫂</span> <span>🫂</span> <span>🫂</span>
        </div>
        <div class="loading-percentage">0%</div>
    </div>
    <div class="fixed-background light-background"></div>
    <div class="fixed-background dark-background"></div>
    <!-- SVG Filter for HQ Glass Effect -->
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" aria-hidden="true">
        <filter id="filter-popup">
            <feTurbulence type="fractalNoise" baseFrequency="0.015 0.025" numOctaves="1" result="warp" />
            <feDisplacementMap xChannelSelector="R" yChannelSelector="G" scale="30" in="SourceGraphic" in2="warp" />
        </filter>
    </svg>

    <!-- NEW: Add the top gradient blur vignette -->
    <div class="top-vignette"></div>
    <!-- FIX: Move the fixed buttons OUTSIDE the page-content-wrapper to prevent them from scrolling with the page. -->
    <div class="fixed top-0 left-0 right-0 flex flex-col items-start p-4 space-y-2 z-50">
        <div class="flex justify-center space-x-4 mb-2">
            <button
               id="ar-button"                    class="px-6 py-2 rounded-full transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none glass-button-base shine-button"
           >
               العربية
           </button>
           <button
               id="fr-button"                    class="px-6 py-2 rounded-full transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none glass-button-base shine-button"
           >
               Français
           </button>
           <button
               id="en-button"                    class="px-6 py-2 rounded-full transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none glass-button-base shine-button"
           >
               English
           </button>
        </div>
        <!-- REFACTOR: Changed the home button to use a cleaner SVG icon. -->
        <div class="flex items-center space-x-2">
            <button id="back-home-button" class="w-10 h-10 rounded-full transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none glass-button-base back-home-button-custom inline-flex items-center justify-center shine-button" aria-label="Back to Home">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            </button>
            <!-- NEW: Login Button for Story Page -->
            <div id="auth-container" class="auth-container glass-button-base">
                <button id="loginButton" class="login-button">
                    <span class="login-text">Login</span>
                </button>
            </div>
        </div>
    </div>
    <!-- NEW: Live Visitor Count (moved to the right) -->
    <div id="visitor-count-container" class="fixed top-0 right-0 p-4 z-50 glass-button-base flex items-center px-3 py-1 rounded-full mr-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
        <span id="visitor-count" class="text-white font-bold text-sm">1</span>
    </div>
    <div id="page-content-wrapper">
        <div id="raw-ar-text" class="language-content" style="display: none;">
               لم يُظهرالناس يومًا كيف يبدو الحب حقًا… لا في الأفلام، ولا في المسلسلات، ولا حتى في القصص.

كلها مجرد أوهام بسيطة خُلقت لتجعلنا نتأثر، نضحك أو نبكي…
وكلها كُتبت أو صُنعت لتُقرأ أو تُشاهد مع من تحب، لا وحدك — لأنها ستؤلمك حين تنتهي.

الحب أساسي في حياتنا، وأعني بالحب أي شيء أو أي شخص… ليس فقط الرومانسية، بل قد يكون بين أناس مقرّبين، شركاء، أو حتى أصدقاء — أصدقاء حقيقيون مقرّبون…
وفي الحقيقة، لا يمكنك أن تحب شخصًا بصدق إن لم يكن صديقك أولًا.

أرواحنا خُلقت لتتوافق مع أشخاص محددين فقط…
ذلك الشخص قادر على أن يغيّرك حقًا — ليس أنت فقط بل العالم من حولك، يمكنه أن يغيّر الزمان والمكان وكأنه سحر.

مع الشخص المناسب:
تصبح أجمل
ملامحك تتغير
جسدك يصبح أخف
تصبح أكثر حساسية
كل شيء يبدو أجمل، حتى ألطف لمسة…
رائحتك تصبح أطيب
ابتسامتك تصير صادقة
وتشعر فعلًا بضحكتك حين تخرج من قلبك
 الطعام يصبح ألذ
الهواء أنقى
الأجواء مميزة لا تُنسى
لحظات بسيطة لكنها لا تُقدَّر بثمن
حتى أغنى الأغنياء لا يستطيعون شراءها.

لا تظن أن الوحدة ستجعل وصولك إلى أهدافك أسهل…
قلة الأصدقاء قد تعطيك وقتًا لمالٍ أكثر، لكنها لن تمنحك السعادة أبدًا.

يسألونني: ماذا تريد أن تصبح حين تكبر؟ فأجيب: أريد أن أنجح، أريد أن أكون ثريًا.
هم يفكرون في المال، أما أنا فأفكر في بساطة الحياة… أن أملك القليل مع الشخص المناسب الذي يجعل أبسط الأشياء أثمن ما في الوجود.

تلك الوجبة الرخيصة التي اشتريتها من المطعم، بعد أن شاركت بعض العملات مع صديقي لأستطيع دفع ثمنها،
كانت ألذ شيء أكلته في حياتي.

تلك الأحاديث التي تبدو بلا معنى، نتكلم عن كل شيء في الحياة،
لكن كل كلمة تحمل قيمة كبيرة.

لا يهمنا حقًا عمّا نتحدث، ما يهم هو أننا نتحدث… أننا موجودان — معًا.
أن نستطيع النظر في أعين بعضنا دون خجل أو غرابة،
أن يكون الصمت الغير مريح مع الآخرين مجرد لحظة سلام بيننا.

ليس لدينا سيارات، فنمشي معًا نصف الطريق إلى البيت، ونقول: “انتبه لنفسك”، ثم نتصل لاحقًا لنتأكد أننا بخير.
نشارك العطور والملابس معًا،
نشاهد الأفلام على هواتفنا الصغيرة لان الإنترنت بطئ.

كل ما هو قبيح يصبح جميلًا معهم…
الرخيص يصبح غاليًا
النكرة يصبح ذا معنى
المكسور يُصلَح
الألعاب البسيطة تصبح بطولات عالمية
البيت الصغير القديم يصبح قصرًا
كل ضحكة تجعلنا أكثر حياة
كل دقيقة تزيد ثقتنا
كل يوم يجعل فُراقنا أصعب.

ومع ذلك، ها أنا هنا… (ابتسامة ساخرة).

نظن أننا قادرون على إنهاء كل شيء والمضي قُدمًا: “ثمانية مليارات إنسان على الأرض، سأتجاوز الأمر وأجد شخصًا آخر”.
تلك الجملة المشهورة… يا لها من كذبة عشنا حياتنا ونحن نسمعها.
ذلك الأمر لن يحدث… تلك المشاعر التي عشتها مع ذلك الشخص لن تتكرر مع أحد آخر.

أقسم أن الله خلق أرواحنا لتتوافق مع قلة نادرة من الناس فقط.

ألا ترى أن هناك أشخاصًا تنسجم معهم بسرعة عجيبة؟ هؤلاء هم الذين خُلِقوا ليكونوا معك.

إن وجدت ذلك الشخص أو الصديق الذي انسجمت معه حقًا، وشعرت معه بكل ما ذكرته سابقًا، فابقَ معه.
لا تتركه!

نعم ستتشاجران،
ستواجهان مشاكل عديدة،
لن تتفقا دائمًا…
لكن كل خلاف سيقوي رابطكما،
سيجعلكما تفهمان بعضكما أكثر،
ستصلان إلى مستوى عالٍ من الفهم المتبادل الصعب بلوغه مع شخص آخر،
ستدركان أننا لسنا كاملين، لكنكما ستتعلمان أن تحبا هذه العيوب… وهذا هو الحب الحقيقي.

إياك أن تنفصل عن شخص مقرّب منك انفصالًا أبديًا، سيطاردك ذلك إلى الأبد…
لأنّ روحيكما ستظلان دائمًا متصلتين.

        </div>
        <div id="raw-fr-text" class="language-content" style="display: none;">
Les gens n’ont jamais vraiment montré ce que l’amour ressent vraiment, ni au cinéma, ni dans les séries, ni même dans les histoires.

Ce ne sont que des fantasmes triviaux pour nous émouvoir, nous faire rire ou pleurer…

Et tout cela est fait pour être lu ou regardé avec quelqu’un que l’on aime, pas seul — parce que ça fait mal quand ça se termine.

L’amour est essentiel dans nos vies, et par « amour » j’entends n’importe quoi, n’importe qui — ce n’est pas seulement la romance ; ça peut être entre des proches, des partenaires, ou des amis — de vrais amis très proches…
Et on ne peut pas vraiment aimer quelqu’un sans d’abord être son ami.

Nos âmes sont faites pour n’appartenir qu’à certaines personnes…

De sorte que cette personne peut réellement te transformer — littéralement… pas seulement toi, mais aussi le monde autour de toi ; elle peut, comme par magie, manipuler le temps et l’espace.

Avec la bonne personne
Tu deviens plus beau / plus belle
Tes traits changent
Ton corps se sent plus léger
Tu deviens plus sensible
Tout paraît mieux, même le toucher le plus léger…
Tu sens meilleur
Ton sourire devient vrai
Tu sens vraiment quand tu ris du fond du cœur
La nourriture a un goût incroyable
L’air devient plus frais
Les ambiences sont si particulières qu’elles ne s’oublient pas
Des moments si simples mais inestimables
Même les plus riches ne peuvent pas les acheter.
Ne crois pas que la solitude facilitera l’atteinte de tes objectifs…

Avoir moins d’amis peut te donner du temps pour gagner plus d’argent, mais ça ne te rendra jamais plus heureux.

On me demande ce que je veux devenir quand je serai grand, je réponds : je veux réussir, je veux devenir riche.

Ils pensent à l’argent, mais moi je pense à la simplicité de la vie, à avoir peu, mais avec la vrai personne qui rend les choses les plus simples les plus précieuses.

Ce repas bon marché que j’ai acheté au restaurant, en partageant quelques pièces avec mon ami pour pouvoir se le permettre,
était la chose la plus délicieuse que j’aie jamais goûtée.

Ces conversations apparemment insignifiantes qu’on a, où l’on parle de tous les sujets de la vie —
pourtant chaque mot compte énormément.

Ce qui importe vraiment, ce n’est pas de quoi on parle ; ce qui compte, c’est que l’on parle, que nous soyons là — ensemble.
Que l’on puisse se regarder dans les yeux sans timidité ni gêne.
Que le silence gênant qu’on aurait avec d’autres devient pour nous un moment de paix.

Nous n’avons pas de voiture, alors on se raccompagne à mi-chemin en se disant « prends soin de toi » puis on s’appelle plus tard pour vérifier que tout va bien.
Ou quand on se prête nos parfums et nos vêtements.
Ou qu’on regarde des films sur nos petits téléphones parce que notre Wi-Fi est nul.

Tout ce qui est laid devient beau avec eux…
Le bon marché devient précieux
L’insignifiant devient plein de sens
Le brisé se répare
Les jeux qu’on fait deviennent champions du monde
La petite maison ancienne devient un château
Chaque rire nous rend plus vivants
Chaque minute renforce notre confiance
Chaque jour rend la séparation de plus en plus impossible.

Et pourtant me voilà, lol…

On croit qu’on peut tout effacer et passer à autre chose — « 8 milliards de personnes sur terre, je m’en remettrai et j’en trouverai une autre. »

Cette fameuse phrase… quel mensonge on nous a toujours raconté.
Tu n’y arriveras pas… ces sentiments que tu as eus avec cette personne ne se répéteront pas avec une autre.

Je jure que Dieu a créé nos âmes pour ne s’accorder qu’avec quelques autres, rares à trouver.

Ne vois-tu pas qu’il y a des gens avec qui on s’entend tout de suite ? Ce sont ceux qui sont destinés à être avec toi.

Si tu trouves (ou as trouvé) cette personne ou cet ami avec qui tu t’entends parfaitement et que tu as ressenti tout ce que j’ai décrit plus haut, alors reste.
Ne pars pas !

Oui, vous vous battrez
Vous aurez des problèmes
Vous ne serez pas toujours d’accord
Mais chaque lutte renforcera votre lien
Vous vous comprendrez mieux
Vous atteindrez un niveau de compréhension difficile à atteindre avec un autre
Vous comprendrez que nous ne sommes pas parfaits mais que l’on apprend à aimer ces imperfections — et c’est ça le véritable amour.

Ne te sépare jamais définitivement d’un proche, cela te hantera pour toujours.

Parce que vos âmes resteront toujours liées…
        </div>
        <div id="raw-en-text" class="language-content" style="display: none;">            
            People never really showed how love really feels like, not in movies not in shows not even in stories.

These are all trivial fantasies to make us emotional, laugh or cry….

And all of them were meant to be read or watched with someone you love, not alone — because they will hurt you when they end.

Love is essential in/for ours lives, and by love I mean anything,anyone — it’s not just romance, it can be between close people, partners ,or friends — real close friends…
And you actually can’t really love someone without being your friend.

Ours souls are only meant to belong with certain people…

So that  person can actually change you — literally… not only you but also the world around you, they can manipulate time and space like magic


With the right one
You become more beautiful
your facial features changes
your body feels lighter 
You become more sensitive 
Everything feels better, even the lightest touch…
You smell better 
Your smile becomes real 
You actually can feel it when you laugh out of your heart
The food tastes really good 
The air becomes fresher 
The vibes are so special they cannot be forgotten 
Moments so simple yet they are priceless 
Not even the richest people can buy them.
Don’t think being alone would make reaching your goals easier…

Less friends might give you time for more money, but it will never make you happier.

They ask me what do I want to be when I grow up, I reply: I want to be successful, I want to be rich.

They think about money, but I think about the simplicity of life, to have a little but with the right person who makes the simplest things the most valuable  

That cheap meal i bought from the restaurant, sharing some coins with my friend to afford it 
Was the most delicious thing I’ve ever had 

Those meaningless conversations we have, talking about every subject in life 
Yet every word means a lot 

We don’t really care about what we’re talking about, what we really care about is that we are talking, that we are…there — together
That we can look in each other’s eyes without being shy or feeling uncomfortable 
That the awkward silence we usually have with other people is just a moment of peace for us.
We have no cars so we walk each other half way home saying take care of yourself and later call to make sure we are alright 
Or when we share perfumes and clothes together 
Or watch movies on our small phones because we have a shitty WiFi 

Everything ugly becomes beautiful with them…
The cheap becomes expensive 
The meaningless becomes meaningful 
The broken gets fixed 
The games we play becomes world champion 
The small old home becomes a castle 
Every giggle makes us more alive 
Every minute makes our trust stronger
Every day makes our separation more impossible.

Yet here I am, lol…
 
We think that we can just end it all and move on  “8billion people on earth,ill get over it and find someone else”  

That famous sentence, oh what a lie we have always been hearing.
You won’t… those feelings you got with that someone won’t be repeated again with another one.

I swear, God has created our souls to only match with a few which are rare to find

Don’t you see that there are people who you get along with too fast, that’s the ones who are meant to be with you

If you find or found that person or friend you really get along with and felt all the things I mentioned before with them, then stay.
Don’t leave ! 

Yes you will fight 
You will have problems 
You won’t always agree 
But every struggle will make your bound stronger 
You’ll understand each other more 
You will reach a high level of understanding that it’s hard to achieve with another 
You will understand that we are not perfect but you’ll learn to fall in love with these imperfections and that’s true love.

Don’t you ever separate with a close one permanently, it will haunt you forever

Because your souls will always be connected…
        </div>
        <div id="content" class="rounded-lg mx-auto content-fading">
            <h1 id="title" class="text-3xl font-bold mb-12"></h1>
            <div id="text-container" class="text-lg leading-relaxed">
                <!-- Pre-rendered English content for SEO -->
            </div>
        </div>
        <!-- REFACTOR: Changed the save button to a circular icon button. -->
        <button
            id="save-progress-button"
            class="fixed bottom-4 left-4 w-14 h-14 rounded-full flex items-center justify-center transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none glass-button-base save-button-custom"
            style="z-index: 60;"
            aria-label="Scroll to saved progress"
        >
            <!-- Bookmark Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" /></svg>
        </button>
        <div id="popup" class="fixed inset-0 flex items-center justify-center z-50">
            <div class="glass-button-base glass-popup shadow-lg w-64 fade-in">
                <!-- REFACTOR: Add a flex container to align the icon and title text. -->
                <div class="flex items-center justify-center mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path></svg>
                    <h2 id="popup-title" class="text-lg font-bold">Save Position</h2>
                </div>
                <p id="popup-text" class="mb-4 text-sm"></p> <!-- FIX: Add text-center to center the question. -->
                <div class="flex justify-end space-x-2">
                    <button
                        id="popup-save-button"
                        class="glass-button-base bg-green-500 text-white px-4 py-2 rounded-full focus:outline-none"
                    >
                        Save
                    </button>
                    <button
                        id="popup-exit-button"
                        class="glass-button-base bg-red-500 text-white px-4 py-2 rounded-full focus:outline-none"
                    >
                        Exit
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- FIX: Consolidate all story initialization logic into a single module script to resolve loading race conditions. -->
    <script type="module">
        // --- Firebase Initialization ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getDatabase, ref, onValue, onDisconnect, serverTimestamp, push, set } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
        // --- Story Script ---
        // This imports the main story logic. The functions will be available in this module's scope.
        import { initializeStoryContent, initializeAuth } from '../story-script.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBIlDy8iaEpCHVc6kPij_zh2zHJYQqiShk",
            authDomain: "dodchstories-435bb.firebaseapp.com",
            databaseURL: "https://dodchstories-435bb-default-rtdb.firebaseio.com",
            projectId: "dodchstories-435bb",
            storageBucket: "dodchstories-435bb.firebasestorage.app",
            messagingSenderId: "52323489131",
            appId: "1:52323489131:web:1ac8292a3953032715682e",
            measurementId: "G-7MCXBETRYQ"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        // Make Firebase services globally available for the imported script.
        const firebaseServices = { 
            db: database, 
            auth: auth, 
            onAuthStateChanged: onAuthStateChanged, 
            ref, onValue, onDisconnect, serverTimestamp, push, set,
            // NEW: Pass all required auth functions
            GoogleAuthProvider, signInWithPopup, signOut, setPersistence, browserSessionPersistence
        };

        // Story-specific configuration
        const contentMap = {
            ar: {
                title: 'مع الشخص الصح',
                rawTextId: 'raw-ar-text',
                savePosition: 'إضافة علامة مرجعية',
                save: 'حفظ',
                exit: 'خروج',
                bookmarkQuestion: 'هل تريد إضافة علامة مرجعية عند كلمة: "{word}"؟',
                questionMark: '؟', // FIX: Use Arabic question mark
                atWord: '', // No longer needed
                positionSaved: 'تم حفظ الموقع',
                forWord: 'لكلمة',
                wordNotFound: 'الكلمة المحفوظة لم يتم العثور عليها في النص الحالي.',
                noWordSaved: 'لم يتم حفظ أي كلمة لهذه اللغة بعد'
            },
            fr: {
                title: 'Avec la vraie personne',
                rawTextId: 'raw-fr-text',
                savePosition: 'Ajouter un marque-page',
                save: 'Enregistrer',
                exit: 'Sortir',
                bookmarkQuestion: 'Mettre en favori cette position au mot : "{word}" ?',
                questionMark: '?',
                atWord: '', // No longer needed
                positionSaved: 'Position enregistrée',
                forWord: 'pour le mot',
                wordNotFound: 'Le mot enregistré n\'a pas été trouvé dans le texte actuel.',
                noWordSaved: 'Aucun mot n\'a été enregistré pour cette langue encore'
            },
            en: {
                title: 'With the right person',
                rawTextId: 'raw-en-text',
                savePosition: 'Bookmark',
                save: 'Save',
                exit: 'Exit',
                bookmarkQuestion: 'Bookmark this position at the word: "{word}"?',
                questionMark: '?',
                atWord: '', // No longer needed
                positionSaved: 'Position saved at',
                forWord: 'for the word',
                wordNotFound: 'Saved word not found in current text.',
                noWordSaved: 'No word has been saved for this language yet'
            },
        };

        (async () => {
            // FIX: The core issue was that `firebaseServices` was not being passed to the initialization function,
            // causing all database operations (like saving bookmarks) to fail. This is now corrected.
            // This also ensures all initialization happens in the correct, sequential order to prevent race conditions.
            
            // 1. Initialize the story content and get the user ID.
            const userId = await initializeStoryContent(contentMap, firebaseServices);
            // 2. Initialize the authentication button.
            initializeAuth(firebaseServices);

            const visitorCountElement = document.getElementById('visitor-count');
            const storyId = document.title.toLowerCase().replace(/[^a-z0-9-]/g, '').replace(/\s+/g, '-');
            const storyVisitorsRef = ref(database, `presence/${storyId}`);            
            // NEW: Get the eye icon to animate it.
            const visitorIcon = document.querySelector('#visitor-count-container svg');
            
            // Listen for changes and update the UI with the correct visitor count.
            onValue(storyVisitorsRef, (snapshot) => {
                if (!visitorCountElement) return;
                const data = snapshot.val();
                const count = data ? Object.keys(data).length : 0;

                // FIX: Animate only when the count actually changes.
                const currentCount = parseInt(visitorCountElement.textContent, 10);
                if (count !== currentCount) {
                    visitorCountElement.textContent = count;
                    // Trigger animations
                    if (visitorIcon) {
                        // Determine which glow to use: green for join, red for leave.
                        const glowClass = count > currentCount ? 'visitor-join-glow' : 'visitor-leave-glow';

                        // FIX: Use a double requestAnimationFrame for the most reliable animation restart.
                        // This guarantees a full frame passes between removing and re-adding the class,
                        // forcing the browser to re-trigger the animation every time.
                        visitorIcon.classList.remove('visitor-join-glow', 'visitor-leave-glow');
                        requestAnimationFrame(() => {
                            requestAnimationFrame(() => {
                                visitorIcon.classList.add(glowClass);
                            });
                        });
                    }
                    visitorCountElement.classList.add('count-pop-animation');
                    visitorCountElement.addEventListener('animationend', () => visitorCountElement.classList.remove('count-pop-animation'), { once: true });
                }
            });

            // Use the .info/connected path to manage online status.
            // This is the official Firebase pattern for robust presence.
            const connectedRef = ref(database, '.info/connected');
            onValue(connectedRef, (snap) => {
                if (snap.val() === true) {
                    // We're connected (or reconnected).
                    // 1. Create a new, unique reference for this specific connection.
                    const myConnectionRef = push(storyVisitorsRef);

                    // 2. When the client disconnects, remove their entry.
                    onDisconnect(myConnectionRef).remove();

                    // 3. Set the value to mark the user as "online".
                    set(myConnectionRef, serverTimestamp());
                }
            });
        })();

    </script>
</body>
</html>
